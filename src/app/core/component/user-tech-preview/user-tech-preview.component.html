<div class="terminal-dashboard">
  @if (isLoading) {
    <div class="loading-state">
      <mat-spinner diameter="24"></mat-spinner>
      <span>Chargement...</span>
    </div>
  } @else if (userTechnologies.length === 0) {
    <div class="empty-state">
      <mat-icon>code_off</mat-icon>
      <p>Aucune technologie favorite</p>
      <a mat-button routerLink="/profile" class="add-tech-btn">
        <mat-icon>add</mat-icon>
        Ajouter des technologies
      </a>
    </div>
  } @else {
    <!-- Header style terminal -->
    <div class="terminal-header">
      <h2 class="terminal-title">
        <span class="title-icon">▶</span>
        <div class="glitch" data-text="MES TECHNOLOGIES">
          MES TECHNOLOGIES
        </div>
        <span class="title-decoration">_</span>
      </h2>
      <div class="status-indicator">
        <span class="status-dot"></span>
        <span class="status-text">{{ userTechnologies.length }} STACK{{ userTechnologies.length > 1 ? 'S' : '' }}</span>
      </div>
    </div>

    <!-- Terminal display -->
    <div class="terminal-display">
      <!-- Command line -->
      <div class="terminal-line">
        <span class="terminal-prompt">$</span>
        <span class="terminal-command">cat /etc/stack/technologies.conf</span>
      </div>

      <!-- Technologies list -->
      <div class="tech-list">
        @for (tech of userTechnologies; track tech._id; let i = $index) {
          <div class="tech-entry" [style.animation-delay]="(i * 0.1) + 's'">
            <div class="tech-header">
              <span class="tech-index">[{{ i + 1 }}]</span>
              <div class="tech-logo">
                <img [src]="tech.logoUrl || getDefaultLogo(tech.name)"
                     [alt]="tech.name"
                     (error)="onImageError($event)">
              </div>
              <span class="tech-name">{{ tech.name }}</span>
              <span class="tech-trending" [class]="'trending-' + tech.trending">
                @if (tech.trending === 'up') { ↗ }
                @if (tech.trending === 'down') { ↘ }
                @if (tech.trending === 'stable') { → }
              </span>
              <span class="tech-rank">RANG #{{ tech.rank }}</span>
            </div>

            @if (tech.versions && tech.versions.length > 0) {
              <div class="tech-versions">
                @for(version of tech.versions; track version; let j = $index) {
                  @if (j < 2) {
                    <div class="version-row">
                      <span class="version-type" [class]="'type-' + version.type.toLowerCase()">{{ version.type }}</span>
                      <span class="version-number">{{ version.label }}</span>
                      @if (version.releaseDate && version.supportDuration) {
                        <div class="support-bar">
                          <div class="support-fill"
                               [style.width.%]="getSupportPercentageFromDuration(version.releaseDate, version.supportDuration)"
                               [class]="getSupportColorClass(version.releaseDate, version.supportDuration)"
                               [matTooltip]="getSupportTooltip(version.releaseDate, version.supportDuration, version.type)"
                               matTooltipPosition="above">
                          </div>
                        </div>
                        <span class="support-percent">{{ getSupportPercentageFromDuration(version.releaseDate, version.supportDuration) | number:'1.0-0' }}%</span>
                      }
                    </div>
                  }
                }
              </div>
            }

            <div class="tech-stats">
              <span class="stat-label">Popularité:</span>
              <div class="popularity-bar">
                <div class="popularity-fill" [style.width.%]="tech.popularity"></div>
              </div>
              <span class="stat-value">{{ tech.popularity }}%</span>
            </div>
          </div>
        }
      </div>

      <div class="terminal-cursor">_</div>
    </div>
  }
</div>
