<div class="news-layout">
  <aside class="ads-left">
    <ins class="adsbygoogle" style="display:block" data-full-width-responsive="true"></ins>
  </aside>
  <section>
    <mat-toolbar class="news-toolbar">
      <span><app-tape-text-console></app-tape-text-console></span>
    </mat-toolbar>

    <div class="articles-wrapper">
      <div class="filters">
        @if(actualiteType.length > 0) {
          <mat-chip-listbox>
            @for(type of actualiteType; track type; let i = $index) {
              <mat-chip-option (selectionChange)="filterByType(i)"> {{ type }}</mat-chip-option>
            }
          </mat-chip-listbox>
        }
      </div>

      <!-- Empty state -->
      @if(filteredArticles.length === 0) {
        <div class="empty-state">
          <div class="terminal-empty">
            <span class="prompt">$</span>
            <span class="command">cat /var/log/articles</span>
          </div>
          <div class="empty-output">
            <span class="status">[INFO]</span>
            <span class="message">no entries found</span>
          </div>
        </div>
      }

      <div class="article-grid" [class.single-article]="filteredArticles.length === 1">
        @for(article of filteredArticles; track trackById(i, article); let i = $index) {
          <mat-card class="article-card" appearance="outlined">
            <!-- Bouton "open in new" flottant -->
            <button mat-icon-button class="open-btn" aria-label="Voir l'article complet"
              (click)="openArticlePage(article)">
              <mat-icon>open_in_new</mat-icon>
            </button>

            <mat-card-header>
              <div mat-card-avatar class="header-image"
                style="background-image: url({{article.img}}); background-size: cover; background-position: center;">
              </div>
              <mat-card-title>{{ article.title }}</mat-card-title>
              <mat-card-subtitle>[{{ article.category }}] - P4cm4n972</mat-card-subtitle>
            </mat-card-header>

            <img mat-card-image [src]="article.img || defaultPicture" [alt]="article.title" />

            <mat-card-content>
              <div class="meta-row">
                <span class="article-date">{{ article.date }}</span>

                <!-- Bouton de recommandation unifiÃ© -->
                <button
                  mat-icon-button
                  [class.liked]="hasRecommended(article)"
                  [class.processing]="isProcessing(article)"
                  [disabled]="!currentUser || isProcessing(article)"
                  [matBadge]="getRecommendationCount(article)"
                  [matBadgeColor]="'primary'"
                  [matBadgePosition]="'above after'"
                  [matTooltip]="!currentUser ? 'Connecte-toi pour recommander' :
                               hasRecommended(article) ? 'Retirer ma recommandation' : 'Recommander cet article'"
                  (click)="toggleRecommendation(article)"
                  aria-label="Recommander cet article">
                  <mat-icon>{{ hasRecommended(article) ? 'thumb_up' : 'thumb_up_off_alt' }}</mat-icon>
                </button>
              </div>
            </mat-card-content>

            <mat-card-actions>
              <button mat-raised-button color="accent"
                (click)="openArticleModal(article)">Lire la suite</button>
            </mat-card-actions>
          </mat-card>
        }
      </div>
    </div>
  </section>
  <aside class="ads-right">
    <ins class="adsbygoogle" style="display:block" data-full-width-responsive="true"></ins>
  </aside>
</div>
