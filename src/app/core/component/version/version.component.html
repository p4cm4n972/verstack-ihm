<div class="version-layout">
  <aside class="ads-left">
    <!-- Pub gauche -->
    <ins class="adsbygoogle" style="display:block"></ins>
  </aside>
  @if(isLoading){<div class="retro-loader">
    <div class="dots">
      <span>.</span><span>.</span><span>.</span><span>.</span><span>.</span>
    </div>
    <p class="retro-text">Chargement des langages...</p>
  </div>}
  <section>
    @if(!isLoading){<div>
      <mat-tab-group [(selectedIndex)]="selectedDomainIndex">
        @for(domain of domaines; track domain; let i = $index ){<mat-tab (click)="selectedDomain = domain">
          <ng-template mat-tab-label>{{ domain }}</ng-template>
        </mat-tab>}
      </mat-tab-group>

      <div class="languages-grid">
        @for(language of domainLangages(filteredLangages, selectedDomain, selectedDomainIndex); track language.name; let i = $index)
        {<ng-container>
          <mat-card class="language-card" appearance="outlined">
            <mat-card-header>
              <mat-card-title-group>
                <mat-card-title class="language-title">
                  {{ language.name }}
                  <span class="trending-indicator" [class]="'trending-' + getTrending(language.name)"
                    [matTooltip]="getTrending(language.name) === 'up' ? 'En hausse' : getTrending(language.name) === 'down' ? 'En baisse' : 'Stable'"
                    matTooltipPosition="above">
                    @switch (getTrending(language.name)) {
                      @case ('up') { ↗ }
                      @case ('down') { ↘ }
                      @case ('stable') { → }
                    }
                  </span>
                  @if(language.versions && language.versions.length > 0) {
                    <span class="status-indicator" [ngClass]="getDataStatusClass(language.versions[0].updatedAt)"
                      [matTooltip]="getDataStatusTooltip(language.versions[0].updatedAt)"
                      matTooltipPosition="above"></span>
                  }
                </mat-card-title>
                <mat-card-subtitle>
                  <mat-icon [ngClass]="getIconColor(language.domain)">
                    {{getIconType(language.domain)}}
                  </mat-icon>
                </mat-card-subtitle>
                @for(version of language.versions; track version.label) {
                <mat-card-subtitle [class]="'version-badge version-' + version.type.toLowerCase()">
                  <span> {{ version.type }}:</span>&nbsp; {{ version.label }}
                </mat-card-subtitle>
                }
                <img loading="lazy" mat-card-sm-image [src]="language.logoUrl" [alt]="language.name"
                  class="language-logo" />
              </mat-card-title-group>
            </mat-card-header>
           @if(!authStatus){
            <ng-container>
              <mat-card-content>
                <p class="description"> {{ language.description }} <br>
                  <small> <a (click)="needLoginDialog()" class="more-link">voir plus</a></small>
                </p>
              </mat-card-content>
            </ng-container>} @else {
            <ng-container>
              <mat-card-content style="margin: 10px;">
                <mat-card appearance="outlined">
                  <mat-card-content>
                    @for(version of language.versions; track version.label) {
                    <mat-progress-bar [mode]="getProgressMode(version.supportDuration ?? 0)" style="margin-bottom: 5px;"
                      [value]="getSupportPercentageFromDuration(version.releaseDate, version.supportDuration ?? 0)"
                      [ngClass]="getSupportColor(version.releaseDate, version.supportDuration ?? 0)"
                      matTooltip="{{ getSupportTooltip(version.releaseDate, version.supportDuration ?? 0, version.type) }}"
                      matTooltipPosition="above">
                    </mat-progress-bar>}
                  </mat-card-content>
                </mat-card>
              </mat-card-content>
            </ng-container>}
            <mat-card-actions class="card-actions">
              <a [href]="language.documentation" target="_blank" class="doc-link">
                <button mat-raised-button color="primary">Documentation</button>
              </a>
              
              @if(authStatus) {
                <button mat-icon-button
                  [attr.aria-label]="(isPinned(language.name) ? 'Retirer ' : 'Ajouter ') + language.name + ' de vos favoris'"
                  [matTooltip]="(isPinned(language.name) ? 'Retirer ' : 'Ajouter ') + language.name + ' à votre board'"
                  (click)="pinLanguage(language)"
                  [disabled]="isFavorisLoading()">
                  @if(isFavorisLoading()) {
                    <mat-icon>hourglass_empty</mat-icon>
                  } @else {
                    <mat-icon [fontIcon]="isPinned(language.name) ? 'beenhere' : 'new_label'"
                      [ngClass]="{ 'pinned-icon': isPinned(language.name) }"></mat-icon>
                  }
                </button>
              }
            </mat-card-actions>
          </mat-card>







        </ng-container>}
      </div>
    </div>}
  </section>
  <aside class="ads-right">
    <!-- Pub droite -->
    <ins class="adsbygoogle" style="display:block"></ins>
  </aside>
</div>

<!-- <section>
    <mat-tab-group mat-align-tabs="start" class="vertical-tab-group" (selectedTabChange)="filterLangages($event)">
    @for(domain of domaines; track domain; let i = $index){<mat-tab [label]="domain">
    </mat-tab>}
  </mat-tab-group>
  
  <div class="language-container">
    <mat-grid-list cols="4" rowHeight="320px" gutterSize="16px">
     @for(langage of filteredLangages; track langage.name) {
        <mat-grid-tile>
        <mat-card class="language-card">
          <mat-card-header>
            <div mat-card-avatar class="language-logo">
              <img [src]="langage.logoUrl" [alt]="langage.name" />
            </div>
            <mat-card-title>{{ langage.name }}</mat-card-title>
            <mat-card-subtitle>{{ langage.domain.join(', ') }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p>{{ langage.description }}</p>
            <p><strong>Version Actuelle :</strong> {{ langage.currentVersion }}</p>
            <p><strong>Date de Sortie :</strong> {{ langage.releaseDate }}</p>
          </mat-card-content>
          <mat-card-actions>
            <a mat-button color="primary" [href]="langage.documentation" target="_blank">
              Documentation
            </a>
          </mat-card-actions>
        </mat-card>
      </mat-grid-tile>}
    </mat-grid-list>
  </div>
</section> -->