<div class="profile-dashboard">
  @if(userData) {
    <!-- Header avec avatar et infos principales -->
    <div class="dashboard-header">
      <div class="avatar-section">
        <div class="avatar-container">
          <img class="profile-avatar" [src]="userData.profilePicture || defaultProfilePicture" alt="Avatar" />
          <div class="status-indicator"></div>
        </div>
        <div class="user-info">
          <h1 class="username">{{ userData.pseudo || 'Utilisateur' }}</h1>
          <p class="user-role">{{ getUserRole() }}</p>
          <p class="member-since">Membre depuis {{ formatDate(userData.createdAt) }}</p>
        </div>
      </div>
      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="openEditProfileDialog()">
          <mat-icon>edit</mat-icon>
          Modifier le profil
        </button>
        <button mat-icon-button (click)="shareProfile()" title="Partager">
          <mat-icon>share</mat-icon>
        </button>
        <button mat-icon-button (click)="exportProfile()" title="Exporter">
          <mat-icon>download</mat-icon>
        </button>
      </div>
    </div>

    <!-- Gauges principales (compteurs à aiguilles) -->
    <div class="gauges-section">
      <div class="gauge-card">
        <h3>Niveau d'expérience</h3>
        <svg viewBox="0 0 200 120" class="gauge">
          <defs>
            <linearGradient id="gaugeGradient1" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#00ff41;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#39ff14;stop-opacity:1" />
            </linearGradient>
          </defs>
          <!-- Arc de fond -->
          <path d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="12" stroke-linecap="round"/>
          <!-- Arc de progression -->
          <path [attr.d]="getGaugeArc(getExperienceLevel() * 10)" fill="none" stroke="url(#gaugeGradient1)" stroke-width="12" stroke-linecap="round" class="gauge-progress"/>
          <!-- Aiguille -->
          <line [attr.x1]="100" [attr.y1]="100"
                [attr.x2]="getGaugeNeedleX(getExperienceLevel() * 10)"
                [attr.y2]="getGaugeNeedleY(getExperienceLevel() * 10)"
                stroke="#00ff41" stroke-width="2" class="gauge-needle"/>
          <circle cx="100" cy="100" r="5" fill="#00ff41"/>
          <!-- Valeur -->
          <text x="100" y="90" text-anchor="middle" fill="white" font-size="32" font-weight="bold">{{ getExperienceLevel() }}</text>
          <text x="100" y="110" text-anchor="middle" fill="#888" font-size="12">Niveau</text>
        </svg>
      </div>

      <div class="gauge-card">
        <h3>Profil complété</h3>
        <svg viewBox="0 0 200 120" class="gauge">
          <defs>
            <linearGradient id="gaugeGradient2" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#00bcd4;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#0097a7;stop-opacity:1" />
            </linearGradient>
          </defs>
          <path d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="12" stroke-linecap="round"/>
          <path [attr.d]="getGaugeArc(getProfileCompletion())" fill="none" stroke="url(#gaugeGradient2)" stroke-width="12" stroke-linecap="round" class="gauge-progress"/>
          <line [attr.x1]="100" [attr.y1]="100"
                [attr.x2]="getGaugeNeedleX(getProfileCompletion())"
                [attr.y2]="getGaugeNeedleY(getProfileCompletion())"
                stroke="#00bcd4" stroke-width="2" class="gauge-needle"/>
          <circle cx="100" cy="100" r="5" fill="#00bcd4"/>
          <text x="100" y="90" text-anchor="middle" fill="white" font-size="32" font-weight="bold">{{ getProfileCompletion() }}</text>
          <text x="100" y="110" text-anchor="middle" fill="#888" font-size="12">%</text>
        </svg>
      </div>
    </div>

    <!-- Compteurs numériques -->
    <div class="counters-section">
      <div class="counter-card">
        <div class="counter-icon">
          <mat-icon>code</mat-icon>
        </div>
        <div class="counter-value">{{ userData.favoris.length || 0 }}</div>
        <div class="counter-label">Technologies maîtrisées</div>
        <div class="counter-trend positive">
          <mat-icon>trending_up</mat-icon>
          <span>+{{ Math.floor((userData.favoris.length || 0) / 5) }} ce mois</span>
        </div>
      </div>

      <div class="counter-card">
        <div class="counter-icon">
          <mat-icon>calendar_today</mat-icon>
        </div>
        <div class="counter-value">{{ getDaysActive() }}</div>
        <div class="counter-label">Jours d'activité</div>
        <div class="counter-trend positive">
          <mat-icon>trending_up</mat-icon>
          <span>Continu</span>
        </div>
      </div>
    </div>

    <!-- Section Technologie avec mini-gauges -->
    <div class="tech-section">
      <div class="section-header">
        <h2>
          <mat-icon>code</mat-icon>
          Stack Technique
        </h2>
        <button mat-button color="primary" (click)="addTechnology()">
          <mat-icon>add</mat-icon>
          Ajouter
        </button>
      </div>

      @if (userData.favoris && userData.favoris.length > 0) {
        <div class="tech-grid">
          @for (tech of userData.favoris; track tech) {
            <div class="tech-item">
              <div class="tech-header">
                <span class="tech-name">{{ tech.name || tech }}</span>
                <span class="tech-percentage">{{ getTechLevel(tech) }}%</span>
              </div>
              <!-- Mini gauge circulaire -->
              <svg viewBox="0 0 100 100" class="mini-gauge">
                <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="8"/>
                <circle cx="50" cy="50" r="45" fill="none"
                        [attr.stroke]="getTechColor(tech)"
                        stroke-width="8"
                        stroke-linecap="round"
                        [attr.stroke-dasharray]="283"
                        [attr.stroke-dashoffset]="283 - (283 * getTechLevel(tech) / 100)"
                        class="tech-progress-circle"/>
                <text x="50" y="55" text-anchor="middle" fill="white" font-size="18" font-weight="bold">{{ getTechLevel(tech) }}</text>
              </svg>
              <div class="tech-level-text">{{ getLevelText(getTechLevel(tech)) }}</div>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">
          <mat-icon>code</mat-icon>
          <p>Aucune technologie favorite ajoutée</p>
          <button mat-raised-button color="primary" (click)="addTechnology()">
            Ajouter une technologie
          </button>
        </div>
      }
    </div>

    <!-- Timeline d'activité -->
    <div class="activity-section">
      <div class="section-header">
        <h2>
          <mat-icon>timeline</mat-icon>
          Activité Récente
        </h2>
      </div>

      <div class="timeline">
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <div class="timeline-date">Aujourd'hui</div>
            <div class="timeline-text">Profil consulté {{ getRandomViews() }} fois</div>
          </div>
        </div>

        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <div class="timeline-date">Il y a 2 jours</div>
            <div class="timeline-text">Ajout de {{ (userData.favoris.length || 0) > 0 ? (userData.favoris[0].name || userData.favoris[0]) : 'technologie' }}</div>
          </div>
        </div>
      </div>
    </div>

  } @else {
    <div class="loading-state">
      <mat-spinner diameter="60"></mat-spinner>
      <p>Chargement du tableau de bord...</p>
    </div>
  }
</div>
