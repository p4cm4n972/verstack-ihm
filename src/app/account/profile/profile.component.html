<div class="profile-dashboard">
  @if(userData) {
    <!-- Header avec avatar et infos principales -->
    <div class="dashboard-header">
      <div class="avatar-section">
        <div class="avatar-container">
          <img class="profile-avatar" [src]="getProfileAvatar()" alt="Avatar" />
          <div class="status-indicator"></div>
          @if (userData.useGravatar && !userData.profilePicture) {
            <div class="gravatar-indicator" title="Avatar Gravatar">G</div>
          }
        </div>
        <div class="user-info">
          <h1 class="username">{{ userData.pseudo || 'Utilisateur' }}</h1>
          <p class="user-role">{{ getUserRole() }}</p>
          <p class="member-since">Membre depuis {{ formatDate(userData.createdAt) }}</p>
        </div>
      </div>
      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="openEditProfileDialog()">
          <mat-icon>edit</mat-icon>
          Modifier le profil
        </button>
        <button mat-icon-button (click)="shareProfile()" title="Partager">
          <mat-icon>share</mat-icon>
        </button>
        <button mat-icon-button (click)="exportProfile()" title="Exporter">
          <mat-icon>download</mat-icon>
        </button>
      </div>
    </div>

    <!-- Gauges principales (compteurs à aiguilles) -->
    <div class="gauges-section">
      <div class="gauge-card">
        <h3>Niveau d'expérience</h3>
        <svg viewBox="0 0 200 120" class="gauge">
          <defs>
            <linearGradient id="gaugeGradient1" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#00bcd4;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#4dd0e1;stop-opacity:1" />
            </linearGradient>
          </defs>
          <!-- Arc de fond -->
          <path d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="12" stroke-linecap="round"/>
          <!-- Arc de progression -->
          <path [attr.d]="getGaugeArc(getExperienceLevel() * 10)" fill="none" stroke="url(#gaugeGradient1)" stroke-width="12" stroke-linecap="round" class="gauge-progress"/>
          <!-- Aiguille -->
          <line [attr.x1]="100" [attr.y1]="100"
                [attr.x2]="getGaugeNeedleX(getExperienceLevel() * 10)"
                [attr.y2]="getGaugeNeedleY(getExperienceLevel() * 10)"
                stroke="#00bcd4" stroke-width="2" class="gauge-needle"/>
          <circle cx="100" cy="100" r="5" fill="#00bcd4"/>
          <!-- Valeur -->
          <text x="100" y="90" text-anchor="middle" fill="white" font-size="32" font-weight="bold">{{ getExperienceLevel() }}</text>
          <text x="100" y="110" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="12">Niveau</text>
        </svg>
      </div>

      <div class="gauge-card">
        <h3>Profil complété</h3>
        <svg viewBox="0 0 200 120" class="gauge">
          <defs>
            <linearGradient id="gaugeGradient2" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#4dd0e1;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#80deea;stop-opacity:1" />
            </linearGradient>
          </defs>
          <path d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="12" stroke-linecap="round"/>
          <path [attr.d]="getGaugeArc(getProfileCompletion())" fill="none" stroke="url(#gaugeGradient2)" stroke-width="12" stroke-linecap="round" class="gauge-progress"/>
          <line [attr.x1]="100" [attr.y1]="100"
                [attr.x2]="getGaugeNeedleX(getProfileCompletion())"
                [attr.y2]="getGaugeNeedleY(getProfileCompletion())"
                stroke="#4dd0e1" stroke-width="2" class="gauge-needle"/>
          <circle cx="100" cy="100" r="5" fill="#4dd0e1"/>
          <text x="100" y="90" text-anchor="middle" fill="white" font-size="32" font-weight="bold">{{ getProfileCompletion() }}</text>
          <text x="100" y="110" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="12">%</text>
        </svg>
      </div>

      <div class="gauge-card">
        <h3>Projets Git</h3>
        <svg viewBox="0 0 200 120" class="gauge">
          <defs>
            <linearGradient id="gaugeGradient3" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#ff9800;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#ffb74d;stop-opacity:1" />
            </linearGradient>
          </defs>
          <path d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="12" stroke-linecap="round"/>
          <path [attr.d]="getGaugeArc(Math.min(getProjectCount() * 10, 100))" fill="none" stroke="url(#gaugeGradient3)" stroke-width="12" stroke-linecap="round" class="gauge-progress"/>
          <line [attr.x1]="100" [attr.y1]="100"
                [attr.x2]="getGaugeNeedleX(Math.min(getProjectCount() * 10, 100))"
                [attr.y2]="getGaugeNeedleY(Math.min(getProjectCount() * 10, 100))"
                stroke="#ff9800" stroke-width="2" class="gauge-needle"/>
          <circle cx="100" cy="100" r="5" fill="#ff9800"/>
          <text x="100" y="90" text-anchor="middle" fill="white" font-size="32" font-weight="bold">{{ getProjectCount() }}</text>
          <text x="100" y="110" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="12">Connectés</text>
        </svg>
      </div>
    </div>

    <!-- Compteurs numériques -->
    <div class="counters-section">
      <div class="counter-card">
        <div class="counter-icon">
          <mat-icon>code</mat-icon>
        </div>
        <div class="counter-value">{{ userData.favoris.length || 0 }}</div>
        <div class="counter-label">Technologies maîtrisées</div>
        <div class="counter-trend positive">
          <mat-icon>trending_up</mat-icon>
          <span>+{{ Math.floor((userData.favoris.length || 0) / 5) }} ce mois</span>
        </div>
      </div>

      <div class="counter-card">
        <div class="counter-icon">
          <mat-icon>folder</mat-icon>
        </div>
        <div class="counter-value">{{ getProjectCount() }}</div>
        <div class="counter-label">Projets réalisés</div>
        <div class="counter-trend positive">
          <mat-icon>trending_up</mat-icon>
          <span>+{{ Math.floor(getProjectCount() / 3) }} ce mois</span>
        </div>
      </div>

      <div class="counter-card">
        <div class="counter-icon">
          <mat-icon>people</mat-icon>
        </div>
        <div class="counter-value">{{ getFriendsCount() }}</div>
        <div class="counter-label">Contacts réseau</div>
        <div class="counter-trend neutral">
          <mat-icon>remove</mat-icon>
          <span>Stable</span>
        </div>
      </div>

      <div class="counter-card">
        <div class="counter-icon">
          <mat-icon>calendar_today</mat-icon>
        </div>
        <div class="counter-value">{{ getDaysActive() }}</div>
        <div class="counter-label">Jours d'activité</div>
        <div class="counter-trend positive">
          <mat-icon>trending_up</mat-icon>
          <span>Continu</span>
        </div>
      </div>
    </div>

    <!-- Section Technologie avec mini-gauges -->
    <div class="tech-section">
      <div class="section-header">
        <h2>
          <mat-icon>code</mat-icon>
          Stack Technique
        </h2>
        <button mat-button color="primary" (click)="addTechnology()">
          <mat-icon>add</mat-icon>
          Ajouter
        </button>
      </div>

      @if (userData.favoris && userData.favoris.length > 0) {
        <div class="tech-grid">
          @for (tech of userData.favoris; track tech) {
            <div class="tech-item">
              <!-- Logo de la technologie -->
              <div class="tech-logo">
                <img [src]="tech.logoUrl || 'https://placehold.co/70x70'" [alt]="tech.name || tech">
              </div>
              <!-- Nom de la technologie -->
              <div class="tech-name">{{ tech.name || tech }}</div>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">
          <mat-icon>code</mat-icon>
          <p>Aucune technologie favorite ajoutée</p>
          <button mat-raised-button color="primary" (click)="addTechnology()">
            Ajouter une technologie
          </button>
        </div>
      }
    </div>

    <!-- Achievements / Badges -->
    <div class="achievements-section">
      <div class="section-header">
        <h2>
          <mat-icon>emoji_events</mat-icon>
          Accomplissements
        </h2>
      </div>

      <div class="achievements-grid">
        <div class="achievement-card" [class.unlocked]="hasAchievement('first-code')">
          <div class="achievement-icon">
            <mat-icon>code</mat-icon>
          </div>
          <h4>Premier Pas</h4>
          <p>Ajouter sa première technologie</p>
          @if (hasAchievement('first-code')) {
            <div class="achievement-badge">✓ Débloqué</div>
          }
        </div>

        <div class="achievement-card" [class.unlocked]="hasAchievement('full-stack')">
          <div class="achievement-icon">
            <mat-icon>layers</mat-icon>
          </div>
          <h4>Full Stack</h4>
          <p>Maîtriser 5 technologies</p>
          <div class="achievement-progress">{{ getAchievementProgress('full-stack') }}</div>
        </div>

        <div class="achievement-card" [class.unlocked]="hasAchievement('expert')">
          <div class="achievement-icon">
            <mat-icon>star</mat-icon>
          </div>
          <h4>Expert</h4>
          <p>Atteindre 10 technologies</p>
          <div class="achievement-progress">{{ getAchievementProgress('expert') }}</div>
        </div>

        <div class="achievement-card" [class.unlocked]="hasAchievement('progress')">
          <div class="achievement-icon">
            <mat-icon>trending_up</mat-icon>
          </div>
          <h4>Profil Pro</h4>
          <p>Profil complété à 80%</p>
          @if (hasAchievement('progress')) {
            <div class="achievement-badge">✓ Débloqué</div>
          }
        </div>

        <div class="achievement-card" [class.unlocked]="hasAchievement('social')">
          <div class="achievement-icon">
            <mat-icon>people</mat-icon>
          </div>
          <h4>Social</h4>
          <p>10 contacts dans le réseau</p>
          <div class="achievement-progress">{{ getAchievementProgress('social') }}</div>
        </div>

        <div class="achievement-card" [class.unlocked]="hasAchievement('productive')">
          <div class="achievement-icon">
            <mat-icon>rocket_launch</mat-icon>
          </div>
          <h4>Productif</h4>
          <p>Créer 20 projets</p>
          <div class="achievement-progress">{{ getAchievementProgress('productive') }}</div>
        </div>
      </div>
    </div>

  } @else {
    <div class="loading-state">
      <mat-spinner diameter="60"></mat-spinner>
      <p>Chargement du tableau de bord...</p>
    </div>
  }
</div>
